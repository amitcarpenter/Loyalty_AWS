<div class="page-content-wrapper">
    <div class="page-content">
        <div class="page-bar">
            <div class="page-title-breadcrumb">
                <div class="pull-left">
                    <div class="page-title">
                        <%= __('Offer Details') %>
                    </div>
                </div>
                <ol class="breadcrumb page-breadcrumb pull-right">
                    <li>
                        <i class="fa fa-home"></i>&nbsp;<a class="parent-item" href="/admin/dashboard">
                            <%= __('Home') %>
                        </a>&nbsp;<i class="fa fa-angle-right"></i>
                    </li>
                    <li>
                        <a class="parent-item" href="#">
                            <%= __('Offer Details') %>
                        </a>&nbsp;<i class="fa fa-angle-right"></i>
                    </li>
                </ol>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-head" style="background-color: <%= adminThemeColor %>;">
                        <header>
                            <%= adminBusinessName %>
                        </header>
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <h4 class="card-title">
                                <%= offer.title || '___' %>
                            </h4>
                            <a href="/admin/offers/list" class="btn btn-round btn-primary">
                                <%= __('Back to Offers') %>
                            </a>
                        </div>
                        <div class="row">
                            <p class="countdown-text"> <strong>
                                    <%= __('Offer End In') %>:
                                </strong>
                            <div id="countdown" class="countdown-text"></div>
                            </p>
                            <div class="col-md-6">
                                <h5>
                                    <%= __('Offer Information') %>
                                </h5>
                                <p><strong>
                                        <%= __('Title') %>:
                                    </strong>
                                    <%= offer.title || '___' %>
                                </p>
                                <p><strong>
                                        <%= __('Description') %>:
                                    </strong>
                                    <%= offer.description || '___' %>
                                </p>
                                <p><strong>
                                        <%= __('Discount') %>:
                                    </strong>
                                    <%= offer.discount_percentage %> %
                                </p>
                                <p><strong>
                                        <%= __('Start Date') %>:
                                    </strong>
                                    <%= offer.start_date ? new Date(offer.start_date).toLocaleDateString() : '___' %>
                                </p>
                                <p><strong>
                                        <%= __('End Date') %>:
                                    </strong>
                                    <%= offer.end_date ? new Date(offer.end_date).toLocaleDateString() : '___' %>
                                </p>
                            </div>
                        </div>
                        <div class="mt-3">
                            <a href="/admin/offers/edit/<%= offer.id %>" class="btn btn-round btn-warning">
                                <%= __('Edit Offer') %>
                            </a>
                            <a href="/admin/offers/delete/<%= offer.id %>" class="btn btn-round btn-danger">
                                <%= __('Delete Offer') %>
                            </a>
                        </div>
                        <!-- Redeemed Offers Section -->
                        <div class="mt-4">
                            <h5>
                                <%= __('Redeemed Offers') %>
                            </h5>
                            <% if (offerRedeemed.length> 0) { %>
                                <ul class="list-group">
                                    <% offerRedeemed.forEach((redeem)=> { %>
                                        <li class="list-group-item">
                                            <strong>
                                                <%= __('Customer Name') %>:
                                            </strong>
                                            <%= redeem.Customer.name %>,
                                                <strong>
                                                    <%= __('Contact Number') %>:
                                                </strong>
                                                <%= redeem.Customer.contact_number %>
                                        </li>
                                        <% }); %>
                                </ul>
                                <% } else { %>
                                    <p>
                                        <%= __('No offers redeemed yet.') %>
                                    </p>
                                    <% } %>
                        </div>

                        <div class="mt-5">
                            <h5>
                                <%= __('Redeemed Offers') %>
                            </h5>
                            <table class="table table-striped table-bordered">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>
                                            <%= __('Name') %>
                                        </th>
                                        <th>
                                            <%= __('Content Number') %>
                                        </th>
                                        <th>
                                            <%= __('Redeemed Date') %>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% if (offerRedeemed.length> 0) { %>
                                        <% offerRedeemed.forEach((send, index)=> { %>
                                            <tr>
                                                <td>
                                                    <%= index + 1 %>
                                                </td>
                                                <td>
                                                    <%= send.Customer.name%>
                                                </td>
                                                <td>
                                                    <%= send.Customer.contact_number %>
                                                </td>


                                                <td>
                                                    <%= send.createdAt ? new Date(send.createdAt).toLocaleDateString()
                                                        : '___' %>
                                                </td>
                                            </tr>
                                            <% }) %>
                                                <% } else { %>
                                                    <tr>
                                                        <td colspan="6" class="text-center">
                                                            <%= __('No SMS sends found') %>
                                                        </td>
                                                    </tr>
                                                    <% } %>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .countdown-text {
        font-size: 2rem;
        text-align: center;
        margin-top: 10px;
    }
</style>

<script>
    // Calculate and display countdown timer
    function updateCountdown(endDate) {
        var countDownDate = new Date(endDate).getTime();
        var x = setInterval(function () {
            var now = new Date().getTime();
            var distance = countDownDate - now;
            var days = Math.floor(distance / (1000 * 60 * 60 * 24));
            var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            var seconds = Math.floor((distance % (1000 * 60)) / 1000);

            document.getElementById("countdown").innerHTML = days + "d " + hours + "h "
                + minutes + "m " + seconds + "s ";

            if (distance < 0) {
                clearInterval(x);
                document.getElementById("countdown").innerHTML = "Offer Expired";
            }
        }, 1000);
    }

    updateCountdown('<%= offer.end_date %>');
</script>