<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>


.chart-container {
    position: relative;
    width: 80%;
    height: 80%;
    max-width: 1200px;
    max-height: 800px;
}


</style>

<div class="page-content-wrapper">
    <div class="page-content">
        <div class="page-bar">
            <div class="page-title-breadcrumb">
                <div class="pull-left">
                    <div class="page-title">
                        <%= __('Visit Frequency Analysis') %>
                    </div>
                </div>
                <ol class="breadcrumb page-breadcrumb pull-right">
                    <li><i class="fa fa-home"></i>&nbsp;<a class="parent-item" href="/admin/dashboard">
                            <%= __('Home') %>
                        </a>&nbsp;<i class="fa fa-angle-right"></i>
                    </li>
                    <li><a class="parent-item" href="#">
                            <%= __('Purchase Frequency Analysis') %>
                        </a>&nbsp;<i class="fa fa-angle-right"></i>
                    </li>
                </ol>
            </div>
        </div>

        <div class="container mt-5">
            <div class="row">
                <div class="col-md-12">

                    <!-- Charts for Purchase Frequency -->
                    <div class="card mt-3">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-12">
                                    <canvas id="purchaseFrequencyChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Table displaying customer information -->
                    <!-- <div class="mt-5">
                        <table class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                    <th>S. No.</th>
                                    <th>Name</th>
                                    <th>Age</th>
                                    <th>Contact Number</th>
                                    <th>Visit Frequency</th>
                                    <th>Loyalty Points</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% if (items && items.length> 0) { %>
                                    <% items.forEach((customer, index)=> { %>
                                        <tr>
                                            <td>
                                                <%= index + 1 %>
                                            </td>
                                            <td>
                                                <%= customer.name %>
                                            </td>
                                            <td>
                                                <%= customer.age %>
                                            </td>
                                            <td>
                                                <%= customer.contact_number %>
                                            </td>
                                            <td>
                                                <%= customer.visit_frequency %>
                                            </td>
                                            <td>
                                                <%= customer.total_loyalty_point !==null ? customer.total_loyalty_point
                                                    : 0 %>
                                            </td>
                                            <td>
                                                <a href="/admin/edit-customer/<%= customer.id %>"
                                                    class="btn btn-warning">Edit</a>
                                                <a href="/admin/customer/detail/<%= customer.id %>"
                                                    class="btn btn-info">View Details</a>
                                            </td>
                                        </tr>
                                        <% }); %>
                                            <% } else { %>
                                                <tr>
                                                    <td colspan="7" class="text-center">No data found</td>
                                                </tr>
                                                <% } %>
                            </tbody>
                        </table>
                        <nav aria-label="Page navigation example">
                            <ul class="pagination">
                                <% for (let i=1; i <=totalPages; i++) { %>
                                    <li class="page-item <%= i === currentPage ? 'active' : '' %>">
                                        <a class="page-link" href="?page=<%= i %>&search_text=<%= search_text %>">
                                            <%= i %>
                                        </a>
                                    </li>
                                    <% } %>
                            </ul>
                        </nav>
                    </div> -->
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const items = <%- JSON.stringify(items) %>;
        console.log(items);

        const ctxPurchaseFrequency = document.getElementById('purchaseFrequencyChart').getContext('2d');

        if (items && items.length > 0) {
            const purchaseFrequencyData = {
                labels: items.map(item => item.name),
                datasets: [{
                    label: 'Visit Frequency',
                    data: items.map(item => item.visit_frequency),
                    borderColor: 'rgba(75, 192, 192, 1)',
                    backgroundColor: 'rgba(75, 192, 192, 0.9)',
                    fill: true
                }]
            };

            const options = {
                responsive: true,
                maintainAspectRatio: true,
                scales: {
                    x: {
                        beginAtZero: true
                    },
                    y: {
                        beginAtZero: true
                    }
                }
            };

            new Chart(ctxPurchaseFrequency, {
                type: 'line',
                data: purchaseFrequencyData,
                options: options
            });
        }
    });
</script>